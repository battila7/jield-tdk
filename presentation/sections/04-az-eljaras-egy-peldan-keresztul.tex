\section{Az eljárás egy példán keresztül}

\begin{frame}{Az eljárás jellemzői}
A \textit{Pluggable Annotation Processing} API-t használja


\hfill \\

\pause
A \texttt{return} utasítás jelképezi a \texttt{yield} utasítást


\hfill \\

\pause
\textit{Continuation Passing Style}-alapú megvalósítás
\end{frame}


\begin{frame}[fragile]{Prímek generálása}
\begin{center}
\begin{lstlisting}[language=java, xleftmargin=15pt,
        basicstyle=\fontsize{7}{9}\selectfont,
        numbers=left,
        numbersep=5pt, escapechar=!,
        linebackgroundcolor={
            \btLstHL<1>{30} % No highlighting
            \btLstHL<2>{5}
            \btLstHL<3>{20}
        }]
@Generator
private Stream<Integer> generatePrimes() {
    LinkedList<Integer> primes = new LinkedList<>();
    primes.add(2);
    return 2;

    int current = 1;

    loop:
    do {
        current += 2;
        for (int i : primes) {
            if (current % i == 0) {
                continue loop;
            }
        }

        primes.add(current);

        return current;
    } while (true);
}
\end{lstlisting}
\end{center}
\par
\end{frame}


\begin{frame}[fragile]{Prímek generálása -- Vágási pontok}
\begin{center}
\begin{lstlisting}[language=java, xleftmargin=15pt,
        basicstyle=\fontsize{7}{9}\selectfont,
        numbers=left,
        numbersep=5pt, escapechar=!,
        linebackgroundcolor={
            \btLstHL<1>{30} % No highlighting
            \btLstHL<2>{5, 20}
            \btLstHL<3>{10, 21}
            \btLstHL<4>{14}
            \btLstHL<5>{12-16}
        }]
@Generator
private Stream<Integer> generatePrimes() {
    LinkedList<Integer> primes = new LinkedList<>();
    primes.add(2);
    return 2;

    int current = 1;

    loop:
    do {
        current += 2;
        for (int i : primes) {
            if (current % i == 0) {
                continue loop;
            }
        }

        primes.add(current);

        return current;
    } while (true);
}
\end{lstlisting}
\end{center}
\par
\end{frame}


\begin{frame}[t, fragile]{A metódus darabjai}
\noindent
\begin{minipage}[t][0.4\textheight][t]{\textwidth}
    \noindent
    \begin{minipage}{.50\textwidth}
    \noindent
    \begin{center}\textbf{Eredeti kód}\end{center}
    \begin{lstlisting}[language=java, basicstyle=\scriptsize]
    if (current % i == 0) {
        continue loop;
    }
    \end{lstlisting}
    \end{minipage}\hfill
    \begin{minipage}{.50\textwidth}
    \begin{center}\textbf{Continuation}\end{center}
    \begin{center}
        \begin{tabular}{l | c}
            \texttt{if} & 1 \\
            \texttt{else} & 2 \\
            \texttt{continue} & 3 \\
            \texttt{continue loop} & 3 \\
            \texttt{break} & 3 \\
            \texttt{break loop} & 3
        \end{tabular}
    \end{center}
    \end{minipage}
\end{minipage} \\
\begin{minipage}[b][0.6\textheight][t]{\textwidth}
    \begin{center}\textbf{Új darab}\end{center}
    \begin{lstlisting}[language=java, basicstyle=\scriptsize]
    private Bounce<Integer> primes_8(GeneratorState<Integer> contParam) {
        if (current % i == 0) {
            return Bounce.cont(()->primes_4(contParam));
        }
        return Bounce.cont(()->primes_7(contParam));
    }
    \end{lstlisting}
\end{minipage}
\end{frame}
